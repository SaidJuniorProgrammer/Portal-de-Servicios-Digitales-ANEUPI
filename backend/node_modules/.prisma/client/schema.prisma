generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Rol {
  USER
  ADMIN
}

enum EstadoSolicitud {
  PENDIENTE_PAGO
  EN_REVISION
  APROBADO
  RECHAZADO
}

model Usuario {
  id             Int         @id @default(autoincrement())
  email          String      @unique
  password       String
  rol            Rol         @default(USER)
  fechaRegistro  DateTime    @default(now())
  nombreCompleto String
  cedula         String      @unique
  direccion      String?
  telefono       String?
  solicitudes    Solicitud[]
  auditorias     Auditoria[]

  @@map("usuarios")
}

model TipoDocumento {
  id              Int     @id @default(autoincrement())
  nombre          String
  descripcion     String?
  precio          Decimal @db.Decimal(10, 2)
  activo          Boolean @default(true)
  codigoPlantilla String

  camposRequeridos Json?

  solicitudes Solicitud[]

  @@map("tipos_documentos")
}

model Solicitud {
  id                Int             @id @default(autoincrement())
  usuarioId         Int
  usuario           Usuario         @relation(fields: [usuarioId], references: [id])
  tipoDocumentoId   Int
  tipoDocumento     TipoDocumento   @relation(fields: [tipoDocumentoId], references: [id])
  estado            EstadoSolicitud @default(PENDIENTE_PAGO)
  precioAlSolicitar Decimal         @db.Decimal(10, 2)
  fechaSolicitud    DateTime        @default(now())
  fechaAprobacion   DateTime?

  codigoSolicitud String? @unique

  datosSolicitud Json?

  comprobantePagoUrl String?
  nombreArchivo      String?
  extensionArchivo   String?
  pdfGeneradoUrl     String?
  observacionAdmin   String?

  @@map("solicitudes")
}

model Auditoria {
  id         Int      @id @default(autoincrement())
  fecha      DateTime @default(now())
  accion     String
  detalle    String?
  usuario    String?
  usuarioId  Int
  usuarioRef Usuario  @relation(fields: [usuarioId], references: [id])

  @@map("auditorias")
}
